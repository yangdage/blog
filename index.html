<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>Marks &amp; Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Marks & Notes">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Marks & Notes">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Marks & Notes">
<meta name="twitter:description">
  
    <link rel="alternate" href="/atom.xml" title="Marks &amp; Notes" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css">
  

  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7f1ea269d2e25e1cda2420b588322207";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Marks &amp; Notes</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">The more I know, the less.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-go/golang时区转换问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/go/go/golang时区转换问题.html" class="article-date">
  <time datetime="2017-03-31T16:00:00.000Z" itemprop="datePublished">2017-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/go/">go</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/go/go/golang时区转换问题.html">golang时区转换问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="time-Parse默认转换时间为UTC时区"><a href="#time-Parse默认转换时间为UTC时区" class="headerlink" title="time.Parse默认转换时间为UTC时区"></a>time.Parse默认转换时间为UTC时区</h3><p>golang中转换时间的时候都是习惯性的直接使用time.Parse()函数，没有注意这个函数转换出来的时间默认会是UTC国际标准时间。</p>
<p>这个时间是伦敦时间时间为准，中国大陆、中国香港、中国澳门、中国台湾、蒙古国、新加坡、马来西亚、菲律宾、西澳大利亚州的时间与UTC的时差均为+8，也就是UTC+8。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t1, _ := time.Parse(<span class="string">"2006-01-02 15:04:05"</span>, <span class="string">"2017-04-01 13:02:01"</span>)</span><br><span class="line">t2, _ := time.ParseInLocation(<span class="string">"2006-01-02 15:04:05"</span>, <span class="string">"2017-04-01 13:02:01"</span>, time.Local)</span><br><span class="line"><span class="comment">//结果:Parse:8</span></span><br><span class="line">fmt.Printf(<span class="string">"Parse:%v\n"</span>, t1.Sub(t2).Seconds() / <span class="number">3600</span>)</span><br></pre></td></tr></table></figure>
<p>以上结果Parse函数转换的时间是跟本地时间相差了8个小时。</p>
<p>如果有需求计算两个时间间隔的，最好使用ParseInLocation函数转换成本地时区的时间进行计算。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/go/go/golang时区转换问题.html" data-id="cj0ywiuyf0003p4qexh3x0nw2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-go/golang时区转换问题" data-title="golang时区转换问题" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  
    <article id="post-cache/Redis缓存失效更新策略" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/cache/cache/Redis缓存失效更新策略.html" class="article-date">
  <time datetime="2016-04-23T16:00:00.000Z" itemprop="datePublished">2016-04-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/cache/">cache</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/cache/cache/Redis缓存失效更新策略.html">Redis缓存失效策略</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>当缓存失效时，一般会去DB查询数据，再次加载到缓存，并设置好失效时间。但是在高并发的情况下，缓存失效会导致DB的压力陡增，也叫做缓存穿透。</p>
<p>最理想的状态是，我们缓存中一直有需要查询的数据，查询永远不会直接穿透到DB层。当然，这只是理想状态，一般情况下我们只要防止在缓存失效的时候不让高并发请求打到我们DB的查询上就行。解决方式是在DB查询时保证只有一个任务在执行就行。这里要区分单系统和分布式系统的情况。</p>
<p>这里有几种缓存更新的策略。</p>
<h3 id="定时器查询数据更新到缓存"><a href="#定时器查询数据更新到缓存" class="headerlink" title="定时器查询数据更新到缓存"></a>定时器查询数据更新到缓存</h3><p>系统启动指定的定时器去定时更新缓存中的数据。所有用户的请求都只查询缓存中的数据，缓存中没有也不会去查询DB。这种方式适合能够确定查询的数据一定是热数据、小数据的情况。如果是针对无法区分冷热的数据，也不知道到底要查哪些数据放到缓存中合适，这种情况就不适合用这种方式更新缓存。</p>
<h3 id="查询DB任务加锁"><a href="#查询DB任务加锁" class="headerlink" title="查询DB任务加锁"></a>查询DB任务加锁</h3><p>当缓存中取不到数据时，在查询DB的方法上加锁，保证只有一个线程查询DB。如果确定只有一个web服务的话，这种方式是最方便快速的解决方式，但是我们不能保证我们的系统以后不会部署分布式集群里。如果部署到集群里，我们在任务上加锁也没用，实际上还是有并发的DB查询。</p>
<h3 id="使用缓存锁查询DB任务"><a href="#使用缓存锁查询DB任务" class="headerlink" title="使用缓存锁查询DB任务"></a>使用缓存锁查询DB任务</h3><p>Redis提供了<code>SETNX</code>命令设置一个key，这个命令意思是，如果要设置的key不存在则返回1，如果已存在则返回0，memcached也提供了类似的<code>add</code>命令。无论是单点系统还是分布式系统都能保证同一时间只有一个查询DB的任务。缓存锁最好加上一个很短的失效时间，确保这个时间内任务能够执行完就好，一般定为3-5秒，设置缓存失效时间的另一个重要原因是考虑到任务可能执行失败的情况，后续请求能继续使用这个缓存锁。</p>
<h3 id="双key缓存，一个缓存数据，一个缓存失效时间"><a href="#双key缓存，一个缓存数据，一个缓存失效时间" class="headerlink" title="双key缓存，一个缓存数据，一个缓存失效时间"></a>双key缓存，一个缓存数据，一个缓存失效时间</h3><p>假设要缓存一个用户信息，并且缓存将在30分钟后失效。</p>
<p>设计一个key（userInfo_{userId}）缓存用户信息数据，并且设置失效时间为30分钟。<br>再设计一个key（expire<em>userInfo</em>{userId}）,值随便定，并且设置失效时间为25分钟，一定要在主要信息失效之前失效。<br>查询数据时先查key（expire<em>userInfo</em>{userId}）是否存在，如果不存在，则继续按上一个解决方式使用缓存锁启动一个任务查询用户信息数据追加到缓存里，并且设置失效时间为30分钟，另增对应缓存失效key，设置缓存失效时间为25分钟。如果存在则继续查询用户信息key（userInfo_{userId}）对应的数据返回。</p>
<h3 id="双key缓存，一个用作缓存锁，一个缓存数据，缓存数据最前面加上系统时间"><a href="#双key缓存，一个用作缓存锁，一个缓存数据，缓存数据最前面加上系统时间" class="headerlink" title="双key缓存，一个用作缓存锁，一个缓存数据，缓存数据最前面加上系统时间"></a>双key缓存，一个用作缓存锁，一个缓存数据，缓存数据最前面加上系统时间</h3><p>缓存锁功能还是跟上面的一样，缓存数据，设置失效时间为30分钟，数据最前面加上系统时间类似（time_value）,当读取缓存数据的时候，如果缓存中没有或者当前时间减time小于5分钟，使用缓存锁查询DB任务，并更新缓存。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/cache/cache/Redis缓存失效更新策略.html" data-id="cj0ywiuzh000ep4qevircdaoy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-cache/Redis缓存失效更新策略" data-title="Redis缓存失效策略" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  
    <article id="post-mark/docker常用命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/mark/mark/docker常用命令.html" class="article-date">
  <time datetime="2016-04-19T16:00:00.000Z" itemprop="datePublished">2016-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/mark/">mark</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/mark/mark/docker常用命令.html">Docker常用命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="版本查看"><a href="#版本查看" class="headerlink" title="版本查看"></a>版本查看</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure>
<h3 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search <span class="variable">$imageName</span>$</span><br></pre></td></tr></table></figure>
<h3 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull <span class="variable">$imageName</span>$</span><br></pre></td></tr></table></figure>
<h3 id="查看所有镜像"><a href="#查看所有镜像" class="headerlink" title="查看所有镜像"></a>查看所有镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<h3 id="查看镜像历史"><a href="#查看镜像历史" class="headerlink" title="查看镜像历史"></a>查看镜像历史</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">history</span> <span class="variable">$imageName</span>$</span><br></pre></td></tr></table></figure>
<h3 id="删除所有镜像"><a href="#删除所有镜像" class="headerlink" title="删除所有镜像"></a>删除所有镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi $(docker images -q)</span><br></pre></td></tr></table></figure>
<h3 id="删除所有未打标签的镜像"><a href="#删除所有未打标签的镜像" class="headerlink" title="删除所有未打标签的镜像"></a>删除所有未打标签的镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi $(docker images -q <span class="_">-f</span> dangling=<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>
<h3 id="上传镜像"><a href="#上传镜像" class="headerlink" title="上传镜像"></a>上传镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push <span class="variable">$imageName</span>$</span><br></pre></td></tr></table></figure>
<h3 id="查看所有容器"><a href="#查看所有容器" class="headerlink" title="查看所有容器"></a>查看所有容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps <span class="_">-a</span></span><br></pre></td></tr></table></figure>
<h3 id="查看最近启动的容器"><a href="#查看最近启动的容器" class="headerlink" title="查看最近启动的容器"></a>查看最近启动的容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps <span class="_">-l</span></span><br></pre></td></tr></table></figure>
<h3 id="查看所有容器ID"><a href="#查看所有容器ID" class="headerlink" title="查看所有容器ID"></a>查看所有容器ID</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps <span class="_">-a</span> -q</span><br></pre></td></tr></table></figure>
<h3 id="杀死所有启动的容器"><a href="#杀死所有启动的容器" class="headerlink" title="杀死所有启动的容器"></a>杀死所有启动的容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">kill</span> $(docker ps <span class="_">-a</span> -q)</span><br></pre></td></tr></table></figure>
<h3 id="删除所有容器"><a href="#删除所有容器" class="headerlink" title="删除所有容器"></a>删除所有容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm $(docker ps <span class="_">-a</span> -q)</span><br></pre></td></tr></table></figure>
<h3 id="保存容器为镜像"><a href="#保存容器为镜像" class="headerlink" title="保存容器为镜像"></a>保存容器为镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit <span class="variable">$containerID</span>$ <span class="variable">$newImageName</span>$</span><br></pre></td></tr></table></figure>
<h3 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run [OPTIONS] IMAGE[:TAG] [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">-i:标准输入给容器</span><br><span class="line">-t:分配一个虚拟终端</span><br><span class="line"><span class="_">-d</span>:以守护进程方式运行</span><br><span class="line">-P:默认匹配docker容器的5000端口号到宿主机的49153 to 65535端口</span><br><span class="line">-p HOT_PORT:CONTAINER_PORT:指定端口号</span><br><span class="line">--name:指定容器的名称</span><br><span class="line">--rm:退出时删除容器</span><br></pre></td></tr></table></figure>
<h3 id="进入容器终端"><a href="#进入容器终端" class="headerlink" title="进入容器终端"></a>进入容器终端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t <span class="variable">$imageName</span>$ /bin/bash</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/mark/mark/docker常用命令.html" data-id="cj0ywiv09000vp4qepufas6kv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-mark/docker常用命令" data-title="Docker常用命令" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  
    <article id="post-go/go-gob" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/go/go/go-gob.html" class="article-date">
  <time datetime="2016-04-18T16:00:00.000Z" itemprop="datePublished">2016-04-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/go/">go</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/go/go/go-gob.html">Go中gob序列化反序列化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="gob序列化反序列化"><a href="#gob序列化反序列化" class="headerlink" title="gob序列化反序列化"></a>gob序列化反序列化</h3><p>当使用了gob序列化一个对象，反序列化时一定要同样使用gob反序列化。因为使用gob序列化对象时会在字节数组最前面加上字节头数据。</p>
<h3 id="普通string与-byte转换"><a href="#普通string与-byte转换" class="headerlink" title="普通string与[]byte转换"></a>普通<strong>string</strong>与<strong>[]byte</strong>转换</h3><p>string转换为byte数组</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	<span class="keyword">var</span> s <span class="keyword">string</span> = <span class="string">"abcdefg"</span></span><br><span class="line">	bs := []<span class="keyword">byte</span>(s)</span><br><span class="line">	<span class="comment">//[97 98 99 100 101 102 103]</span></span><br><span class="line">	fmt.Println(bs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>byte数组转string</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	<span class="keyword">var</span> bs1 = []<span class="keyword">byte</span>&#123;<span class="number">97</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>&#125;</span><br><span class="line">	<span class="keyword">var</span> s <span class="keyword">string</span> = <span class="keyword">string</span>(bs1)</span><br><span class="line">	<span class="comment">//abcdefg</span></span><br><span class="line">	fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用gob转换string和-byte"><a href="#使用gob转换string和-byte" class="headerlink" title="使用gob转换string和[]byte"></a>使用gob转换<strong>string</strong>和<strong>[]byte</strong></h3><p>string转byte数组</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"bytes"</span></span><br><span class="line">	<span class="string">"encoding/gob"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	<span class="keyword">var</span> s <span class="keyword">string</span> = <span class="string">"abcdefg"</span></span><br><span class="line">	buf := &amp;bytes.Buffer&#123;&#125;</span><br><span class="line">	gob.NewEncoder(buf).Encode(&amp;s)</span><br><span class="line">	bs := buf.Bytes()</span><br><span class="line">	<span class="comment">//[10 12 0 7 97 98 99 100 101 102 103]</span></span><br><span class="line">	fmt.Println(bs)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//     abcdefg</span></span><br><span class="line">	fmt.Println(s1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>gob将string转byte数组时候会在最前面加上4个字节的头数据，这时如果使用普通方式将这个字节数组转string，前面会多出莫名奇妙的字符（显示为空格）。其中Encode()方法和Decode()方法都需传一个指针参数。Go会根据反射机制自动查找对应的数据结构类型。</p>
<p>byte数组转string</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"bytes"</span></span><br><span class="line">	<span class="string">"encoding/gob"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">func</span> main() &#123;</span><br><span class="line">	<span class="keyword">var</span> s <span class="keyword">string</span> = <span class="string">"abcdefg"</span></span><br><span class="line">	buf := &amp;bytes.Buffer&#123;&#125;</span><br><span class="line">	gob.NewEncoder(buf).Encode(&amp;s)</span><br><span class="line">	<span class="keyword">var</span> s1 <span class="keyword">string</span></span><br><span class="line">	gob.NewDecoder(buf).Decode(&amp;s1)</span><br><span class="line">	<span class="comment">//abcdefg</span></span><br><span class="line">	fmt.Println(s1)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/go/go/go-gob.html" data-id="cj0ywiuyg0004p4qe22ehfbbs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-go/go-gob" data-title="Go中gob序列化反序列化" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  
    <article id="post-mark/markdown-mathjax" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/mark/mark/markdown-mathjax.html" class="article-date">
  <time datetime="2016-04-11T16:00:00.000Z" itemprop="datePublished">2016-04-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/mark/">mark</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/mark/mark/markdown-mathjax.html">Mathjax in Markdown</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="分数表示"><a href="#分数表示" class="headerlink" title="分数表示"></a>分数表示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\frac&#123;1&#125;&#123;3&#125; 或者 1 \over 3</span><br></pre></td></tr></table></figure>
<p>$\frac{1}{3}$</p>
<h3 id="上标下标"><a href="#上标下标" class="headerlink" title="上标下标"></a>上标下标</h3><p>^表示上标，_表示下标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x^2</span><br></pre></td></tr></table></figure>
<p>$x^2$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x_2</span><br></pre></td></tr></table></figure>
<p>$x_2$</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x^&#123;y^2&#125;=(1+&#123;\rm e&#125;^2)^&#123;-2xy&#125;</span><br></pre></td></tr></table></figure>
<p>$x^{y^2}=(1+{\rm e}^2)^{-2xy}$</p>
<h3 id="矢量"><a href="#矢量" class="headerlink" title="矢量"></a>矢量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\vec&#123;a&#125; \cdot \vec&#123;b&#125;=0</span><br></pre></td></tr></table></figure>
<p>$\vec{a} \cdot \vec{b}=0$</p>
<h3 id="微积分"><a href="#微积分" class="headerlink" title="微积分"></a>微积分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\int_0^1 x^2 &#123;\rm d&#125;x</span><br></pre></td></tr></table></figure>
<p>$\int_0^1 x^2 {\rm d}x$</p>
<h3 id="极限运算"><a href="#极限运算" class="headerlink" title="极限运算"></a>极限运算</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\lim_&#123;n \rightarrow +\infty&#125; \frac&#123;1&#125;&#123;n(n+1)&#125;</span><br></pre></td></tr></table></figure>
<p>$\lim_{n \rightarrow +\infty} \frac{1}{n(n+1)}$</p>
<h3 id="累加、累乘"><a href="#累加、累乘" class="headerlink" title="累加、累乘"></a>累加、累乘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\sum_&#123;i=0&#125;^n \frac&#123;1&#125;&#123;i^2&#125; 和 \prod_&#123;i=0&#125;^n \frac&#123;1&#125;&#123;i^2&#125;</span><br></pre></td></tr></table></figure>
<p>$\sum_{i=0}^n \frac{1}{i^2}$</p>
<p>$\prod_{i=0}^n \frac{1}{i^2}$</p>
<h3 id="函数表示"><a href="#函数表示" class="headerlink" title="函数表示"></a>函数表示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\cos 2\theta = \cos^2 \theta - \sin^2 \theta =  2 \cos^2 \theta - 1</span><br></pre></td></tr></table></figure>
<p>$\cos 2\theta = \cos^2 \theta - \sin^2 \theta =  2 \cos^2 \theta - 1$</p>
<h3 id="标准正态分布"><a href="#标准正态分布" class="headerlink" title="标准正态分布"></a>标准正态分布</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f(x) = &#123;1 \over \sigma\sqrt&#123;2\pi&#125; &#125;&#123;exp&#125;^\left(&#123;-&#123;x^2 \over 2&#125;&#125;\right)</span><br></pre></td></tr></table></figure>
<p>$f(x) = {1 \over \sigma\sqrt{2\pi} }{\rm exp}^\left({-{x^2 \over 2}}\right)$</p>
<h3 id="希腊字母"><a href="#希腊字母" class="headerlink" title="希腊字母"></a>希腊字母</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">\alpha　A　\beta　B　\gamma　\Gamma　\delta　\Delta　\epsilon　E</span><br><span class="line">\varepsilon　　\zeta　Z　\eta　H　\theta　\Theta　\vartheta \iota　I</span><br><span class="line">\kappa　K　\lambda　\Lambda　\mu　M　\nu　N \xi　\Xi　o　O　\pi　\Pi</span><br><span class="line">\varpi　　\rho　P \varrho　　\sigma　\Sigma　\varsigma　　\tau　T</span><br><span class="line">\upsilon　\Upsilon \phi　\Phi　\varphi　　\chi　X　\psi　\Psi</span><br><span class="line">\omega　\Omega</span><br></pre></td></tr></table></figure>
<p>$\alpha　A　\beta　B　\gamma　\Gamma　\delta　\Delta　\epsilon　E$<br>$\varepsilon　　\zeta　Z　\eta　H　\theta　\Theta　\vartheta \iota　I$<br>$\kappa　K　\lambda　\Lambda　\mu　M　\nu　N \xi　\Xi　o　O　\pi　\Pi$<br>$\varpi　　\rho　P \varrho　　\sigma　\Sigma　\varsigma　　\tau　T$<br>$\upsilon　\Upsilon \phi　\Phi　\varphi　　\chi　X　\psi　\Psi$<br>$\omega　\Omega$</p>
<h3 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">\rm　　罗马体　　　　　　　\it　　意大利体</span><br><span class="line">\bf　　黑体　　　　　　　　\cal 　花体</span><br><span class="line">\sl　　倾斜体　　　　　　　\sf　　等线体</span><br><span class="line">\mit 　数学斜体　　　　　　\tt　　打字机字体</span><br><span class="line">\sc　　小体大写字母</span><br></pre></td></tr></table></figure>
<h3 id="其它特殊字符"><a href="#其它特殊字符" class="headerlink" title="其它特殊字符"></a>其它特殊字符</h3><h4 id="关系运算"><a href="#关系运算" class="headerlink" title="关系运算"></a>关系运算</h4><table>
<thead>
<tr>
<th>符号</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\pm$</td>
<td>\pm</td>
</tr>
<tr>
<td>$\times$</td>
<td>\times</td>
</tr>
<tr>
<td>$\div$</td>
<td>\div</td>
</tr>
<tr>
<td>$\mid$</td>
<td>\mid</td>
</tr>
<tr>
<td>$\nmid$</td>
<td>\nmid</td>
</tr>
<tr>
<td>$\cdot$</td>
<td>\cdot</td>
</tr>
<tr>
<td>$\circ$</td>
<td>\circ</td>
</tr>
<tr>
<td>$\ast$</td>
<td>\ast</td>
</tr>
<tr>
<td>$\bigodot$</td>
<td>\bigodot</td>
</tr>
<tr>
<td>$\bigotimes$</td>
<td>\bigotimes</td>
</tr>
<tr>
<td>$\bigoplus$</td>
<td>\bigoplus</td>
</tr>
<tr>
<td>$\leq$</td>
<td>\leq</td>
</tr>
<tr>
<td>$\geq$</td>
<td>\geq</td>
</tr>
<tr>
<td>$\neq$</td>
<td>\neq</td>
</tr>
<tr>
<td>$\approx$</td>
<td>\approx</td>
</tr>
<tr>
<td>$\equiv$</td>
<td>\equiv</td>
</tr>
<tr>
<td>$\sum$</td>
<td>\sum</td>
</tr>
<tr>
<td>$\prod$</td>
<td>\prod</td>
</tr>
<tr>
<td>$\coprod$</td>
<td>\coprod</td>
</tr>
</tbody>
</table>
<h4 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h4><table>
<thead>
<tr>
<th>符号</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\emptyset$</td>
<td>\emptyset</td>
</tr>
<tr>
<td>$\in$</td>
<td>\in</td>
</tr>
<tr>
<td>$\notin$</td>
<td>\notin</td>
</tr>
<tr>
<td>$\subset$</td>
<td>\subset</td>
</tr>
<tr>
<td>$\supset$</td>
<td>\supset</td>
</tr>
<tr>
<td>$\subseteq$</td>
<td>\subseteq</td>
</tr>
<tr>
<td>$\supseteq$</td>
<td>\supseteq</td>
</tr>
<tr>
<td>$\bigcap$</td>
<td>\bigcap</td>
</tr>
<tr>
<td>$\bigcup$</td>
<td>\bigcup</td>
</tr>
<tr>
<td>$\bigvee$</td>
<td>\bigvee</td>
</tr>
<tr>
<td>$\bigwedge$</td>
<td>\bigwedge</td>
</tr>
<tr>
<td>$\biguplus$</td>
<td>\biguplus</td>
</tr>
<tr>
<td>$\bigsqcup$</td>
<td>\bigsqcup</td>
</tr>
</tbody>
</table>
<h4 id="对数运算"><a href="#对数运算" class="headerlink" title="对数运算"></a>对数运算</h4><table>
<thead>
<tr>
<th>符号</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\log$</td>
<td>\log</td>
</tr>
<tr>
<td>$\lg$</td>
<td>\lg</td>
</tr>
<tr>
<td>$\ln$</td>
<td>\ln</td>
</tr>
</tbody>
</table>
<h4 id="三角运算"><a href="#三角运算" class="headerlink" title="三角运算"></a>三角运算</h4><table>
<thead>
<tr>
<th>符号</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\bot$</td>
<td>\bot</td>
</tr>
<tr>
<td>$\angle$</td>
<td>\angle</td>
</tr>
<tr>
<td>$30^\circ$</td>
<td>30^\circ</td>
</tr>
<tr>
<td>$\sin$</td>
<td>\sin</td>
</tr>
<tr>
<td>$\cos$</td>
<td>\cos</td>
</tr>
<tr>
<td>$\tan$</td>
<td>\tan</td>
</tr>
<tr>
<td>$\cot$</td>
<td>\cot</td>
</tr>
<tr>
<td>$\sec$</td>
<td>\sec</td>
</tr>
<tr>
<td>$\csc$</td>
<td>\csc</td>
</tr>
</tbody>
</table>
<h4 id="微积分运算"><a href="#微积分运算" class="headerlink" title="微积分运算"></a>微积分运算</h4><table>
<thead>
<tr>
<th>符号</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\prime$</td>
<td>\prime</td>
</tr>
<tr>
<td>$\int$</td>
<td>\int</td>
</tr>
<tr>
<td>$\iint$</td>
<td>\iint</td>
</tr>
<tr>
<td>$\iiint$</td>
<td>\iiint</td>
</tr>
<tr>
<td>$\iiiint$</td>
<td>\iiiint</td>
</tr>
<tr>
<td>$\oint$</td>
<td>\oint</td>
</tr>
<tr>
<td>$\lim$</td>
<td>\lim</td>
</tr>
<tr>
<td>$\infty$</td>
<td>\infty</td>
</tr>
<tr>
<td>$\nabla$</td>
<td>\nabla</td>
</tr>
</tbody>
</table>
<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><table>
<thead>
<tr>
<th>符号</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\because$</td>
<td>\because</td>
</tr>
<tr>
<td>$\therefore$</td>
<td>\therefore</td>
</tr>
<tr>
<td>$\forall$</td>
<td>\forall</td>
</tr>
<tr>
<td>$\exists$</td>
<td>\exists</td>
</tr>
<tr>
<td>$\not=$</td>
<td>\not=</td>
</tr>
<tr>
<td>$\not&gt;$</td>
<td>\not&gt;</td>
</tr>
<tr>
<td>$\not\subset$</td>
<td>\not\subset</td>
</tr>
</tbody>
</table>
<h4 id="戴帽符号"><a href="#戴帽符号" class="headerlink" title="戴帽符号"></a>戴帽符号</h4><table>
<thead>
<tr>
<th>符号</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\hat{y}$</td>
<td>\hat{y}</td>
</tr>
<tr>
<td>$\check{y}$</td>
<td>\check{y}</td>
</tr>
<tr>
<td>$\breve{y}$</td>
<td>\breve{y}</td>
</tr>
</tbody>
</table>
<h4 id="连线符号"><a href="#连线符号" class="headerlink" title="连线符号"></a>连线符号</h4><table>
<thead>
<tr>
<th>符号</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\overline{a+b+c+d}$</td>
<td>\overline{a+b+c+d}</td>
</tr>
<tr>
<td>$\underline{a+b+c+d}$</td>
<td>\underline{a+b+c+d}</td>
</tr>
</tbody>
</table>
<h4 id="箭头符号"><a href="#箭头符号" class="headerlink" title="箭头符号"></a>箭头符号</h4><table>
<thead>
<tr>
<th>符号</th>
<th>表示</th>
</tr>
</thead>
<tbody>
<tr>
<td>$\uparrow$</td>
<td>\uparrow</td>
</tr>
<tr>
<td>$\downarrow$</td>
<td>\downarrow</td>
</tr>
<tr>
<td>$\Uparrow$</td>
<td>\Uparrow</td>
</tr>
<tr>
<td>$\Downarrow$</td>
<td>\Downarrow</td>
</tr>
<tr>
<td>$\rightarrow$</td>
<td>\rightarrow</td>
</tr>
<tr>
<td>$\leftarrow$</td>
<td>\leftarrow</td>
</tr>
<tr>
<td>$\Rightarrow$</td>
<td>\Rightarrow</td>
</tr>
<tr>
<td>$\Leftarrow$</td>
<td>\Leftarrow</td>
</tr>
<tr>
<td>$\longrightarrow$</td>
<td>\longrightarrow</td>
</tr>
<tr>
<td>$\longleftarrow$</td>
<td>\longleftarrow</td>
</tr>
<tr>
<td>$\Longrightarrow$</td>
<td>\Longrightarrow</td>
</tr>
<tr>
<td>$\Longleftarrow$</td>
<td>\Longleftarrow</td>
</tr>
</tbody>
</table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/mark/mark/markdown-mathjax.html" data-id="cj0ywiuzm000gp4qenb4udyrf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-mark/markdown-mathjax" data-title="Mathjax in Markdown" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  
    <article id="post-java/Java列表组合排序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/java/java/Java列表组合排序.html" class="article-date">
  <time datetime="2016-04-09T16:00:00.000Z" itemprop="datePublished">2016-04-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/java/java/Java列表组合排序.html">Java中List列表排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="简单类型元素排序"><a href="#简单类型元素排序" class="headerlink" title="简单类型元素排序"></a>简单类型元素排序</h3><p>Java中定义的List实现类有：Vector，ArrayList，LinkedList。这些集合类提供了对列表中元素的索引访问和对元素的添加与删除支持，然而并没有提供排序支持。但是java.util.Collections类提供了两种支持，如下：</p>
<ul>
<li>java.util.Collections.sort(java.util.List)</li>
<li>java.util.Collections.sort(java.util.List, java.util.Comparator)</li>
</ul>
<p>第一个方法要求List中元素类实现java.lang.Comparable接口。<br>第二个方法需要在元素类外部使用java.util.Comparator接口。<br>Comparable需要在类内部实现排序方法，Comparator是在类外部实现的排序。<br>Comparator是一个专用的比较器，当这个对象不支持自比较时，就可以写一个比较器来比较两个对象之间大小。<br>我们常用的String和Integer内部就已经实现了Comparable接口。</p>
<p>sort()方法可以支持对List元素的排序。我们可以简单的传一个List对象，也可以传一个List对象和一个Comparator。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		list.add(<span class="string">"aaaa"</span>);</span><br><span class="line">		list.add(<span class="string">"BBBB"</span>);</span><br><span class="line">		list.add(<span class="string">"AAAA"</span>);</span><br><span class="line">		list.add(<span class="string">"bbbb"</span>);</span><br><span class="line">		Collections.sort(list);</span><br><span class="line">		System.out.println(list.toString());	<span class="comment">//[AAAA, BBBB, aaaa, bbbb]</span></span><br></pre></td></tr></table></figure>
<p>以上List中元素的类型都是String类型的，排序的顺序是根据每个字符的ASCII/Unicode值顺序排序的。Unicode编码中，英文大写字母A-Z是排在小写字母a-z前面的。如果我们想让元素逆序排序，只需要传给sort()方法一个反序Comparator即可，反序Comparator对象可以直接由Connections.reverseOrder()方法获取。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		list.add(<span class="string">"aaaa"</span>);</span><br><span class="line">		list.add(<span class="string">"BBBB"</span>);</span><br><span class="line">		list.add(<span class="string">"AAAA"</span>);</span><br><span class="line">		list.add(<span class="string">"bbbb"</span>);</span><br><span class="line">		Comparator comp = Collections.reverseOrder();</span><br><span class="line">		Collections.sort(list, comp);</span><br><span class="line">		System.out.println(list.toString());	<span class="comment">//[bbbb, aaaa, BBBB, AAAA]</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="自定义类集合排序"><a href="#自定义类集合排序" class="headerlink" title="自定义类集合排序"></a>自定义类集合排序</h3><p>我们要对一个自定义的类进行排序，有两种方式，一种是让该类实现Comparable接口，并实现compareTo()方法。另一种是在类外部单独定义一个比较器，比较器实现Comparator接口。<br>现在我们定义一个Person类，有三个属性：name，birth，score，分别对应姓名，生日，和分数。我们实现一个按分数的排序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Person</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String birth;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, String birth, <span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.birth = birth;</span><br><span class="line">        <span class="keyword">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getBirth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> birth;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(String birth)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.birth = birth;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> score;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScore</span><span class="params">(<span class="keyword">int</span> score)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.score = score;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Person other)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> diff = <span class="keyword">this</span>.getScore() - other.getScore();</span><br><span class="line">		<span class="keyword">if</span> (diff &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Person&#123;"</span> +</span><br><span class="line">                <span class="string">"name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", birth='"</span> + birth + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", score="</span> + score +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;Person&gt; list = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"aaaa"</span>, <span class="string">"1990-01-01"</span>, <span class="number">90</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"BBBB"</span>, <span class="string">"1991-03-14"</span>, <span class="number">85</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"AAAA"</span>, <span class="string">"1992-10-21"</span>, <span class="number">98</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"bbbb"</span>, <span class="string">"1990-08-09"</span>, <span class="number">80</span>));</span><br><span class="line">		Collections.sort(list);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//[Person&#123;name='bbbb', birth='1990-08-09', score=80&#125;, Person&#123;name='BBBB', birth='1991-03-14', score=85&#125;, Person&#123;name='aaaa', birth='1990-01-01', score=90&#125;, Person&#123;name='AAAA', birth='1992-10-21', score=98&#125;]</span></span><br><span class="line"></span><br><span class="line">		System.out.println(list.toString());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们不想使用Person内部定义的排序，我们可以在外部使用Comparator类来实现。下面使用Comparator类实现一个要按出生日期排序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;Person&gt; list = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"aaaa"</span>, <span class="string">"1990-01-01"</span>, <span class="number">90</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"BBBB"</span>, <span class="string">"1991-03-14"</span>, <span class="number">85</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"AAAA"</span>, <span class="string">"1992-10-21"</span>, <span class="number">98</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"bbbb"</span>, <span class="string">"1990-08-09"</span>, <span class="number">80</span>));</span><br><span class="line">		Collections.sort(list, <span class="keyword">new</span> Comparator&lt;Person&gt;() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Person o1, Person o2)</span> </span>&#123;</span><br><span class="line">				<span class="keyword">int</span> diff = o1.getBirth().compareTo(o2.getBirth());</span><br><span class="line">				<span class="keyword">if</span> (diff &gt; <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//[Person&#123;name='aaaa', birth='1990-01-01', score=90&#125;, Person&#123;name='bbbb', birth='1990-08-09', score=80&#125;, Person&#123;name='BBBB', birth='1991-03-14', score=85&#125;, Person&#123;name='AAAA', birth='1992-10-21', score=98&#125;]</span></span><br><span class="line"></span><br><span class="line">		System.out.println(list.toString());</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="多条件排序"><a href="#多条件排序" class="headerlink" title="多条件排序"></a>多条件排序</h3><p>再来实现先按分数高到低，再按出生早晚两个条件来排序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;Person&gt; list = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"aaaa"</span>, <span class="string">"1990-01-01"</span>, <span class="number">90</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"BBBB"</span>, <span class="string">"1991-03-14"</span>, <span class="number">85</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"AAAA"</span>, <span class="string">"1992-01-21"</span>, <span class="number">98</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"AAAA"</span>, <span class="string">"1991-10-21"</span>, <span class="number">98</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"AAAA"</span>, <span class="string">"1992-10-23"</span>, <span class="number">98</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"bbbb"</span>, <span class="string">"1990-08-09"</span>, <span class="number">80</span>));</span><br><span class="line"></span><br><span class="line">		List&lt;Comparator&lt;Person&gt;&gt; comparatorList = <span class="keyword">new</span> ArrayList&lt;Comparator&lt;Person&gt;&gt;();</span><br><span class="line">		comparatorList.add(compareScore);</span><br><span class="line">		comparatorList.add(compareBirth);</span><br><span class="line"></span><br><span class="line">		sort(list, comparatorList);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//[Person&#123;name='AAAA', birth='1991-10-21', score=98&#125;, Person&#123;name='AAAA', birth='1992-01-21', score=98&#125;, Person&#123;name='AAAA', birth='1992-10-23', score=98&#125;, Person&#123;name='aaaa', birth='1990-01-01', score=90&#125;, Person&#123;name='BBBB', birth='1991-03-14', score=85&#125;, Person&#123;name='bbbb', birth='1990-08-09', score=80&#125;]</span></span><br><span class="line"></span><br><span class="line">		System.out.println(list.toString());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(List&lt;Person&gt; list, <span class="keyword">final</span> List&lt;Comparator&lt;Person&gt;&gt; compareList)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (list == <span class="keyword">null</span> || compareList == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		Comparator&lt;Person&gt; comparator = <span class="keyword">new</span> Comparator&lt;Person&gt;() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Person o1, Person o2)</span> </span>&#123;</span><br><span class="line">				<span class="keyword">for</span> (Comparator&lt;Person&gt; tmpComparatoe : compareList) &#123;</span><br><span class="line">					<span class="keyword">if</span> (tmpComparatoe.compare(o1, o2) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">						<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">					&#125; <span class="keyword">else</span> <span class="keyword">if</span> (tmpComparatoe.compare(o1, o2) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">						<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		Collections.sort(list, comparator);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Comparator&lt;Person&gt; compareScore = <span class="keyword">new</span> Comparator&lt;Person&gt;() &#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Person o1, Person o2)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">int</span> diff = o1.getScore() - o2.getScore();</span><br><span class="line">			<span class="keyword">if</span> (diff &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Comparator&lt;Person&gt; compareBirth = <span class="keyword">new</span> Comparator&lt;Person&gt;() &#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Person o1, Person o2)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">int</span> diff = o1.getBirth().compareTo(o2.getBirth());</span><br><span class="line">			<span class="keyword">if</span> (diff &gt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用apache集合操作类ComparatorUtils实现多条件排序"><a href="#使用apache集合操作类ComparatorUtils实现多条件排序" class="headerlink" title="使用apache集合操作类ComparatorUtils实现多条件排序"></a>使用apache集合操作类ComparatorUtils实现多条件排序</h3><p>上述Java原生类实现的多条件排序可读性可维护性都比较差，特别是排序条件多了以后，我们要写更多的if判断和比较器。<br>这里使用apache提供的集合操作类ComparatorUtils可以很快实现上面的排序功能。ComparatorChain排序链类使我们更方便的定义第一排序、第二排序，第三排序等等。<br>首先需要引入Apache-common的beanutils、collections、logging三个包。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanComparator;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.ComparatorUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.comparators.ComparableComparator;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.comparators.ComparatorChain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SortTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;Person&gt; list = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"aaaa"</span>, <span class="string">"1990-01-01"</span>, <span class="number">90</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"BBBB"</span>, <span class="string">"1991-03-14"</span>, <span class="number">85</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"AAAA"</span>, <span class="string">"1992-01-21"</span>, <span class="number">98</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"AAAA"</span>, <span class="string">"1991-10-21"</span>, <span class="number">98</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"AAAA"</span>, <span class="string">"1992-10-23"</span>, <span class="number">98</span>));</span><br><span class="line">		list.add(<span class="keyword">new</span> Person(<span class="string">"bbbb"</span>, <span class="string">"1990-08-09"</span>, <span class="number">80</span>));</span><br><span class="line"></span><br><span class="line">		Comparator mycmp = ComparableComparator.getInstance();</span><br><span class="line">		mycmp = ComparatorUtils.nullLowComparator(mycmp);<span class="comment">// 允许null</span></span><br><span class="line">		mycmp = ComparatorUtils.reversedComparator(mycmp);<span class="comment">// 逆序</span></span><br><span class="line"></span><br><span class="line">		ArrayList&lt;Object&gt; sortFields = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line">		sortFields.add(<span class="keyword">new</span> BeanComparator(<span class="string">"score"</span>, mycmp));<span class="comment">// 第一排序，分数逆序</span></span><br><span class="line">		sortFields.add(<span class="keyword">new</span> BeanComparator(<span class="string">"birth"</span>));<span class="comment">// 第二排序，出生时间顺序</span></span><br><span class="line"></span><br><span class="line">		ComparatorChain multiSort = <span class="keyword">new</span> ComparatorChain(sortFields);</span><br><span class="line">		Collections.sort(list, multiSort);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//[Person&#123;name='AAAA', birth='1991-10-21', score=98&#125;, Person&#123;name='AAAA', birth='1992-01-21', score=98&#125;, Person&#123;name='AAAA', birth='1992-10-23', score=98&#125;, Person&#123;name='aaaa', birth='1990-01-01', score=90&#125;, Person&#123;name='BBBB', birth='1991-03-14', score=85&#125;, Person&#123;name='bbbb', birth='1990-08-09', score=80&#125;]</span></span><br><span class="line"></span><br><span class="line">		System.out.println(list.toString());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/java/java/Java列表组合排序.html" data-id="cj0ywiuz6000ap4qe0ojeimps" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-java/Java列表组合排序" data-title="Java中List列表排序" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  
    <article id="post-javascript/函数声明-表达式-匿名函数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/javascript/javascript/函数声明-表达式-匿名函数.html" class="article-date">
  <time datetime="2016-04-01T16:00:00.000Z" itemprop="datePublished">2016-04-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/javascript/javascript/函数声明-表达式-匿名函数.html">JS里的函数声明/匿名函数/函数表达式/立即执行函数/立即调用表达式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h3><p>函数声明必须首先有个<strong>function</strong>关键字，再指定一个函数名称，自己随便定义，不违反函数名称的定义规则就行，如下格式：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><p>匿名函数不需要定义函数名字，只有一个<strong>function</strong>关键字，其他跟函数声明一样。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="函数表达式"><a href="#函数表达式" class="headerlink" title="函数表达式"></a>函数表达式</h3><p>将一个匿名函数赋值给一个变量来创建一个函数，就形成了函数表达式。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> funName=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>注意：JS解析引擎在解析js代码时，会提升函数声明。</strong></p>
<h3 id="立即执行函数-立即调用表达式"><a href="#立即执行函数-立即调用表达式" class="headerlink" title="立即执行函数/立即调用表达式"></a>立即执行函数/立即调用表达式</h3><p>立即执行函数也叫立即调用表达式。<br>在函数表达式后面直接加一对小括号<strong>()</strong>就构成了立即执行函数。立即执行函数不需要显示调用，在函数定义的时候就直接执行。</p>
<p><strong>强调一点，括号前面必须是函数表达式</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> funName=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="number">111</span>);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>上面代码等价于下面这段：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> funName=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="number">111</span>);</span><br><span class="line">&#125;;</span><br><span class="line">funName();	<span class="comment">//定义完,立即执行</span></span><br></pre></td></tr></table></figure>
<p>既然前面提到了立即执行函数的括号前面必须是函数表达式，好奇心的驱使，我们可以试试函数声明是不是真的不行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="number">111</span>);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>打开浏览器，我们可以看到，确实没有弹出alert提示框。</p>
<p>虽然函数声明不能立即执行，但是JS里提供了很多方式允许我们将函数声明转换为函数表达式。</p>
<ul>
<li>1.改成var funName=function(){//do something};</li>
<li>2.把函数声明用一对括号<strong>()</strong>包裹起来</li>
<li>3.消除函数声明和函数表达式间歧义，例如在函数声明<strong>function</strong>关键字前面加!、+、-</li>
</ul>
<p>第一个就不用解释了，这种定义就是一个最普通的函数表达式。</p>
<p>第二个，把函数声明用一对括号<strong>()</strong>包裹起来<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="number">111</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>
<p>这种写法还有个变体：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="number">111</span>);</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
<p>第三个，在函数声明<strong>function</strong>关键字前面加!、~、+、-</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!<span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="number">111</span>);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~<span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="number">111</span>);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+<span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="number">111</span>);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="number">111</span>);</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>立即执行函数最推荐的写法是<strong>(function(){…})()</strong>，有测试发现这种写法的性能是最优的。我们看过JQuery源码的都知道，JQuery中代码就是包裹在<strong>(function(window,undefined){…})(window)</strong>块里面。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/javascript/javascript/函数声明-表达式-匿名函数.html" data-id="cj0ywiv0h0017p4qezh3senej" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-javascript/函数声明-表达式-匿名函数" data-title="JS里的函数声明/匿名函数/函数表达式/立即执行函数/立即调用表达式" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  
    <article id="post-mark/vim-xml-format" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/mark/mark/vim-xml-format.html" class="article-date">
  <time datetime="2016-03-28T16:00:00.000Z" itemprop="datePublished">2016-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/mark/">mark</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/mark/mark/vim-xml-format.html">Vim下XML文件格式化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-打开需要格式化的文件"><a href="#1-打开需要格式化的文件" class="headerlink" title="1.打开需要格式化的文件"></a>1.打开需要格式化的文件</h3><p>使用vim命令打开需要格式化的xml文件，html也属于xml的一种，因此也可使用该方法格式化html文件。<br>现有一个如下的未格式化的文件：<br><img src="https://raw.githubusercontent.com/yangdage/images/master/20160330/20160328154539.png" alt="origin image"></p>
<h3 id="2-保存临时修改"><a href="#2-保存临时修改" class="headerlink" title="2.保存临时修改"></a>2.保存临时修改</h3><p>如果我们打开后有对文件进行编辑操作，需要保存所做的修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:w</span><br></pre></td></tr></table></figure>
<p>在命令模式下输入上面的命令，保存改动，不退出文件</p>
<h3 id="3-启用自动缩进选项"><a href="#3-启用自动缩进选项" class="headerlink" title="3.启用自动缩进选项"></a>3.启用自动缩进选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:filetype indent on</span><br></pre></td></tr></table></figure>
<h3 id="4-设置文件类型"><a href="#4-设置文件类型" class="headerlink" title="4.设置文件类型"></a>4.设置文件类型</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> filetype=xml</span><br></pre></td></tr></table></figure>
<h3 id="5-全局格式化"><a href="#5-全局格式化" class="headerlink" title="5.全局格式化"></a>5.全局格式化</h3><p>回到文件头：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gg</span><br></pre></td></tr></table></figure>
<p>使用缩进（格式化）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=</span><br></pre></td></tr></table></figure></p>
<p>格式化到文件尾:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">G</span><br></pre></td></tr></table></figure>
<h3 id="6-格式化结果"><a href="#6-格式化结果" class="headerlink" title="6.格式化结果"></a>6.格式化结果</h3><p><img src="https://raw.githubusercontent.com/yangdage/images/master/20160330/20160330115035.png" alt="origin image"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/mark/mark/vim-xml-format.html" data-id="cj0ywiv06000tp4qeaf24ciua" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-mark/vim-xml-format" data-title="Vim下XML文件格式化" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  
    <article id="post-mark/sublime-package-control" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/mark/mark/sublime-package-control.html" class="article-date">
  <time datetime="2016-03-22T16:00:00.000Z" itemprop="datePublished">2016-03-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/mark/">mark</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/mark/mark/sublime-package-control.html">Sublime下的Package Control</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有时候我们安装的Sublime默认情况下没有安装Package Control(暂且叫它插件管理器)，没有安装它的情况下就不能很方便的安装官方的插件。</p>
<p>打开sublime，查看是否存在以下目录</p>
<p><img src="https://raw.githubusercontent.com/yangdage/images/master/20160330/20160330174915.png" alt="package control"></p>
<p>如果没有，我们需要安装Package Control</p>
<p>通过快捷键 <strong>ctrl+`</strong> 或者 <strong>View &gt; Show Console</strong> 菜单打开控制台，复制粘贴以下脚本，确保中间无换行。</p>
<p>Sublime3:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import  urllib.request,os;pf=<span class="string">'Package Control.sublime-package'</span>;ipp=sublime.installed_packages_path();urllib.request.install_opener(urllib.request.build_opener(urllib.request.ProxyHandler()));open(os.path.join(ipp,pf),<span class="string">'wb'</span>).write(urllib.request.urlopen(<span class="string">'http://sublime.wbond.net/'</span>+pf.replace(<span class="string">' '</span>,<span class="string">'%20'</span>)).read())</span><br></pre></td></tr></table></figure>
<p>Sublime2:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import  urllib2,os;pf=<span class="string">'Package Control.sublime-package'</span>;ipp=sublime.installed_packages_path();os.makedirs(ipp)ifnotos.path.exists(ipp)<span class="keyword">else</span>None;urllib2.install_opener(urllib2.build_opener(urllib2.ProxyHandler()));open(os.path.join(ipp,pf),<span class="string">'wb'</span>).write(urllib2.urlopen(<span class="string">'http://sublime.wbond.net/'</span>+pf.replace(<span class="string">' '</span>,<span class="string">'%20'</span>)).read());<span class="built_in">print</span>(<span class="string">'Please restart Sublime Text to finish installation'</span>)</span><br></pre></td></tr></table></figure>
<p>重启sublime，通过快捷键<strong>ctrl+shift+p</strong>打开命令面板，输入package，查看Package Control是否安装正常</p>
<p><img src="https://raw.githubusercontent.com/yangdage/images/master/20160330/20160330175617.png" alt="package control"></p>
<p>出现如上命令选项证明安装已正常，可以愉快的安装乱七八糟的插件了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/mark/mark/sublime-package-control.html" data-id="cj0ywiuzz000op4qenwdc5rba" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-mark/sublime-package-control" data-title="Sublime下的Package Control" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  
    <article id="post-javascript/javascript-closure" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/javascript/javascript/javascript-closure.html" class="article-date">
  <time datetime="2016-03-21T16:00:00.000Z" itemprop="datePublished">2016-03-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/javascript/javascript/javascript-closure.html">Javascript闭包(Closure)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="敌在暗，我在明"><a href="#敌在暗，我在明" class="headerlink" title="敌在暗，我在明"></a>敌在暗，我在明</h3><p>看电影的时候我们经常会看到这样的剧情，当敌暗，我在明时，我们的一举一动他们都了如指掌，我们对他们的情况却一无所知。但是我们需要知道对方的真实情况才能从容的应对，这时候最常见的剧情就是在敌方安插我方的眼线，给我们提供情报支持。</p>
<h3 id="初识Javascript闭包"><a href="#初识Javascript闭包" class="headerlink" title="初识Javascript闭包"></a>初识Javascript闭包</h3><p>我们先来看一段简短的js代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">fun1</span></span>()&#123;</span><br><span class="line">	var i=0;</span><br><span class="line">	<span class="keyword">function</span> <span class="function"><span class="title">fun2</span></span>()&#123;</span><br><span class="line">		<span class="built_in">return</span> i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">return</span> fun2;</span><br><span class="line">&#125;</span><br><span class="line">var result=fun1();</span><br><span class="line">console.log(result());</span><br></pre></td></tr></table></figure>
<p>这里我们做个映射关系：<strong>result</strong>变量相当于我方成员，<strong>i</strong>相当于敌方的一份情报数据，<strong>fun2</strong>就是我方安插在地方的眼线，专门为我们提供情报数据。</p>
<p>注意一下<strong>result=fun1();</strong>这句，这里<strong>fun1()</strong>函数返回的是一个函数<strong>fun2()</strong>，这样<strong>result</strong>实际上就是一个直接指向<strong>fun2()</strong>的函数引用。由于<strong>fun2()</strong>可以直接读取<strong>fun1()</strong>内部的变量<strong>i</strong>，因此我们可以实现在函数<strong>fun1()</strong>的外部获取其内部的成员变量。</p>
<p><strong>fun2()函数就是一个闭包</strong>，引用开始的形容来说，其实js里的闭包就如同一个外部对象安插在一个函数内部的专门对外提供情报的眼线，现在我们来看下<strong>fun2()</strong>函数的特点：</p>
<ul>
<li><strong>fun2()</strong>在<strong>fun1()</strong>函数内部</li>
<li><strong>fun2()</strong>函数里引用了<strong>fun1()</strong>函数里的变量<strong>i</strong></li>
</ul>
<p>其实以上的理解还不是很完善，<strong>真正意义上的闭包不仅仅是指定的某个满足条件的函数，而是这个满足条件的函数和其引用环境（父级往上一直到window对象级的作用域环境）组成的一个整体</strong>。</p>
<h3 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h3><p>闭包是js里一个不可避开的概念，也是一个理解难点，主要原因可能是其正式的书面定义太过于晦涩难懂。在理解闭包之前，我们需要来来梳理一下js里的变量作用域。<br>变量作用域分为以下两种：</p>
<ul>
<li>局部变量</li>
<li>全局变量</li>
</ul>
<p>在js里无论在什么地方定义变量，只要是没有在前面加var声明的，都会被提升为全局变量。即使在函数里面也是一样。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i=<span class="number">100</span>;</span><br><span class="line"><span class="built_in">console</span>.log(i);	<span class="comment">//i=100</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	i=<span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line">fun();</span><br><span class="line"><span class="built_in">console</span>.log(i);	<span class="comment">//i=100</span></span><br></pre></td></tr></table></figure>
<p>以上两段js代码中最后i都会输出100，即使第二段中i定义在函数fun()里面，由于没有加var声明，就相当于声明了一个全局变量，直属于window对象。</p>
<p>如果函数里面的变量加了var声明，那么函数外部一般情况就取不到这个变量的值，Firefox浏览器控制台会输出以下错误信息。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> i=<span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line">fun();</span><br><span class="line"><span class="built_in">console</span>.log(i);	<span class="comment">//ReferenceError: i is not defined</span></span><br></pre></td></tr></table></figure></p>
<p>作用域总结：</p>
<ul>
<li>1.作用域分两种：局部和全局</li>
<li>2.函数内部可以读取全局变量</li>
<li>3.一般情况函数外部无法读取局部变量</li>
<li>4.函数内部变量定义不加var声明，实际相当于定义了一个全局变量</li>
</ul>
<h3 id="函数外部获取局部变量"><a href="#函数外部获取局部变量" class="headerlink" title="函数外部获取局部变量"></a>函数外部获取局部变量</h3><p>上节已经说过，一般情况下，我们是无法在函数外部读取函数内部声明的局部变量的，那怎样才能实现在函数外部获取局部变量了。来，直接上代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> a=<span class="number">100</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">fun2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> b=<span class="number">200</span>;</span><br><span class="line">		<span class="built_in">console</span>.log(a);	<span class="comment">//a=100</span></span><br><span class="line">	&#125;</span><br><span class="line">	fun2();</span><br><span class="line">	<span class="built_in">console</span>.log(b);	<span class="comment">//ReferenceError: b is not defined</span></span><br><span class="line">&#125;</span><br><span class="line">fun1();</span><br></pre></td></tr></table></figure>
<p>从上面代码的输出可以看出来，fun2()函数可以读取fun1()里声明的变量，而fun1()函数里不能获取fun2()里声明的变量。这就是Javascript里的<strong>链式作用域</strong>，子对象可以访问所有上级父对象的所有变量。上面代码里fun2()既然能读到fun1()里的变量，那么如果我们在fun1()最后直接返回fun2()函数，fun1()外部不就可以读取其内部变量了么。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> a=<span class="number">100</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">fun2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> fun2();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result=fun1();</span><br><span class="line"><span class="built_in">console</span>.log(result());</span><br></pre></td></tr></table></figure>
<p>到这里，我们肯定有个疑问，上面那样实现不就是为了在外面获取fun1()里定义的变量a吗，我们用下面的代码也能获取啊！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> a=<span class="number">100</span>;</span><br><span class="line">	<span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result=fun1();</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>
<p>其实不然，闭包不只是为了获取局部变量，更重要的作用是为了让局部变量一直保存在内存中，不被GC(垃圾回收器(garbage collection))回收。再来看下面的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> a=<span class="number">100</span>;</span><br><span class="line">	add=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		a+=<span class="number">1</span>;</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result=fun1();</span><br><span class="line"><span class="built_in">console</span>.log(result());	<span class="comment">//100</span></span><br><span class="line">add();</span><br><span class="line"><span class="built_in">console</span>.log(result());	<span class="comment">//101</span></span><br><span class="line">add();</span><br><span class="line"><span class="built_in">console</span>.log(result());	<span class="comment">//102</span></span><br></pre></td></tr></table></figure>
<p>上面有三句输出，100，101，102，每次执行了一次累加1的函数add(),由于a被闭包引用，所以不会被GC回收，其值一直保存在内存中，所以才会有如上的输出结果。</p>
<h3 id="不要滥用闭包"><a href="#不要滥用闭包" class="headerlink" title="不要滥用闭包"></a>不要滥用闭包</h3><p>由于闭包会常驻内存，所以大量使用闭包会消耗大量的内存，导致内存泄漏。当发生内存泄漏时，我们只有关闭浏览器，这些内存占用才会释放，关闭标签页是没有效果的。</p>
<h3 id="闭包的优点"><a href="#闭包的优点" class="headerlink" title="闭包的优点"></a>闭包的优点</h3><ul>
<li>1.让局部变量常驻内存</li>
<li>2.避免同名全局变量冲突</li>
<li>3.成员私有化<br>第一点和第二点比较好理解，对于第三点，先来一段代码：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj=(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> a=<span class="number">100</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">funB</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		a++;</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">funC</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		a++;</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		b:funB,</span><br><span class="line">		c:funC</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="built_in">console</span>.log(obj.b());	<span class="comment">//101</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.c());	<span class="comment">//102</span></span><br></pre></td></tr></table></figure>
<p>这里就是直接将funB和funC方法付给一个匿名对象的成员，最后直接返回该匿名对象。</p>
<h3 id="闭包常见使用场景"><a href="#闭包常见使用场景" class="headerlink" title="闭包常见使用场景"></a>闭包常见使用场景</h3><p>以下实例展示一个使用闭包解决开发中经常遇到的一个问题。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"button1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"button2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"button3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> btnList=<span class="built_in">document</span>.getElementsByTagName(<span class="string">"input"</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;btnList.length;i++)&#123;</span><br><span class="line">		btnList[i].onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			alert(i);</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>当我们点击界面的三个按钮时，弹出的全是3，是不是觉得奇怪，因为我们的初衷是想第一个按钮弹出0，第二个弹出1，第三个弹出2。</p>
<p>会出现上面的结果，正是闭包惹的祸，由于<strong>btnList[i].onclick</strong>是属于函数<strong>window.onload</strong>之外的对象，他所引用的匿名函数引用了<strong>window.onload</strong>函数里的局部变量<strong>i</strong>，导致<strong>btnList[i].onclick</strong>函数形成一个闭包，i会常驻内存，等到用户点击按钮，这时候<strong>i</strong>的值已经三次<strong>i++</strong>操作（for循环三次），最终导致弹出的都是3。</p>
<p>那究竟怎样才能才能实现我们想要的效果呢，这时候还是要靠闭包，所谓解铃还需系铃人。我们对上面那段代码稍作修改，使用闭包来实现，下面提供两种实现方式。</p>
<ul>
<li>1.立即执行函数表达式</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"button1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"button2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"button3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> btnList=<span class="built_in">document</span>.getElementsByTagName(<span class="string">"input"</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;btnList.length;i++)&#123;</span><br><span class="line">		(<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">			btnList[i].onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">				alert(i);</span><br><span class="line">			&#125;;</span><br><span class="line">		&#125;)(i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>2.闭包函数引用</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"button1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"button2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"button3"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="keyword">var</span> btnClick=<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		alert(i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> btnList=<span class="built_in">document</span>.getElementsByTagName(<span class="string">"input"</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;btnList.length;i++)&#123;</span><br><span class="line">		btnList[i].onclick=btnClick(i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>最后引用《javascript高级程序设计》书上对闭包的定义：<br><strong>闭包</strong>是指有权访问另一个函数作用域中的变量函数</p>
<h3 id="附：函数声明和函数表达式"><a href="#附：函数声明和函数表达式" class="headerlink" title="附：函数声明和函数表达式"></a>附：函数声明和函数表达式</h3><p>js中定义一个函数一般有两种方式：<strong>函数声明</strong>和<strong>函数表达式</strong><br>函数声明：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>函数表达式：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fun1=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这两种方式都可以在实际中应用，但是JS解析器对这两种实现方式的处理并不一样。<strong>JS解析器会在预解析阶段优先读取函数声明的代码，以确保函数能够被引用到；而对于函数表达式，只有在执行到相应的语句时才进行解析。</strong><br>再看下面两段代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fun1();	<span class="comment">//正常执行</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="string">"这个是函数声明"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fun2();	<span class="comment">//报错：TypeError: fun2 is not a function</span></span><br><span class="line"><span class="keyword">var</span> fun2=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	alert(<span class="string">"这个是函数表达式"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为函数声明会被提升，所以第一段里面fun1的声明虽然写在调用代码后面，但其实他已经被提升到执行语句以前了。而对于第二段，虽然声明了变量fun2，fun2的定义也会被提升，但是并不会立即将代码里的匿名函数引用赋值给他，而是要执行到赋值语句的时候才会得到正确的引用，因此在执行<strong>fun2();</strong>语句的时候会报错。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/javascript/javascript/javascript-closure.html" data-id="cj0ywiuz10009p4qefjhwihyt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

<!--

-->

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="post-javascript/javascript-closure" data-title="Javascript闭包(Closure)" data-url="undefined"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"yangdage"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

<!-- 搜索引擎优化 start-->

<!-- 搜索引擎优化 end-->
  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="extend next" rel="next" href="/blog/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/cache/">cache</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/go/">go</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/mark/">mark</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/08/">八月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/03/">三月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/02/">二月 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/go/go/golang时区转换问题.html">golang时区转换问题</a>
          </li>
        
          <li>
            <a href="/blog/cache/cache/Redis缓存失效更新策略.html">Redis缓存失效策略</a>
          </li>
        
          <li>
            <a href="/blog/mark/mark/docker常用命令.html">Docker常用命令</a>
          </li>
        
          <li>
            <a href="/blog/go/go/go-gob.html">Go中gob序列化反序列化</a>
          </li>
        
          <li>
            <a href="/blog/mark/mark/markdown-mathjax.html">Mathjax in Markdown</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 yangdage<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="http://apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script> <script type="text/javascript">
//<![CDATA[
if (typeof jQuery == 'undefined') {
document.write(unescape("%3Cscript src='/js/jquery-2.0.3.min.js' type='text/javascript'%3E%3C/script%3E"));
}
// ]]>
</script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>